services:
  postgresql:
    container_name: postfix_test_postgresql
    extends:
      file: ../docker-compose.yml
      service: postgresql
    ports:
      - "5432:5432"

  postfixadmin:
    container_name: postfix_test_admin
    extends:
      file: ../docker-compose.yml
      service: postfixadmin
    environment:
      POSTFIXADMIN_SETUP_PASSWORD: test_setup_password

  postfix:
    extends:
      file: ../docker-compose.yml
      service: postfix
    container_name: postfix_test_mail
    environment:
      SMTPD_TLS_CERT_FILE: /etc/ssl/certs/cert.pem
      SMTPD_TLS_KEY_FILE: /etc/ssl/certs/key.pem
      SMTPD_TLS_DH1024_PARAM_FILE: /etc/ssl/certs/dh2048.pem
      SMTPD_TLS_DH512_PARAM_FILE: /etc/ssl/certs/dh512.pem
      DOVECOT_DH_FILE: /etc/ssl/certs/dh4096.pem
    volumes:
      - ./test-certs:/etc/ssl/certs
      - maildata:/var/mail

volumes:
  maildata:
